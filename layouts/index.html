<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <!-- RSS feed link -->
  <link rel="alternate" type="application/rss+xml"
        title="Poo Colour Decoder ‚Äî Daily Poo Facts RSS Feed"
        href="{{ .Site.BaseURL }}index.xml" />

  <!-- Page Title & Description (duplicated exactly as before) -->
  <title>{{ .Title }} ‚Äì {{ .Site.Title }}</title>
  <meta name="description" content="Poo Colour Decoder: Instantly analyse your stool colour for fun, education & gut-health insights. 100% private, zero uploads.">
  
  <!-- Duplicate Title / Description block retained (was in original) -->
  <title>{{ .Title }} ‚Äì {{ .Site.Title }}</title>
  <meta name="description" content="Poo Colour Decoder: Instantly analyse your stool colour for fun, education & gut-health insights. 100% private, zero uploads.">

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-XPZVC63DTR"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-XPZVC63DTR', { anonymize_ip: true });
  </script>

  <!-- WebApplication Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Poo Colour Decoder",
    "description": "Analyse your stool color in seconds. 100% private, fun, educational, and medically informed.",
    "url": "https://poopcolor.info/",
    "applicationCategory": "HealthApplication",
    "operatingSystem": "All",
    "keywords": "stool color, poop color analysis, stool color meaning, gut health"
  }
  </script>

  <!-- FAQPage Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "Is this medical advice?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "No‚Äîthis tool is for entertainment and educational use only. Consult a healthcare professional for any medical concerns."
        }
      },
      {
        "@type": "Question",
        "name": "Is my data private?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Yes‚Äîeverything runs locally in your browser; we do not collect or store your images or any personal data."
        }
      }
    ]
  }
  </script>

  <!-- Open Graph / Facebook -->
  <meta property="og:type"        content="website">
  <meta property="og:url"         content="{{ .Permalink }}">
  <meta property="og:title"       content="{{ .Title }} ‚Äì {{ .Site.Title }}">
  <meta property="og:description" content="Analyse your stool colour in seconds. 100% private and educational.">
  <meta property="og:image"       content="{{ .Site.BaseURL }}poo-decoder-preview.png">

  <!-- Twitter -->
  <meta name="twitter:card"        content="summary_large_image">
  <meta name="twitter:url"         content="{{ .Permalink }}">
  <meta name="twitter:title"       content="{{ .Title }} ‚Äì {{ .Site.Title }}">
  <meta name="twitter:description" content="Analyse your stool colour in seconds. 100% private and educational.">
  <meta name="twitter:image"       content="{{ .Site.BaseURL }}poo-decoder-preview.png">

  <link rel="stylesheet" href="/css/styles.css">

  <!-- Inline styles for gauge & badge -->
  <style>
    .badge{display:inline-block;padding:.2rem .6rem;border-radius:4px;font-size:.9rem;font-weight:700;color:#fff}
    .badge-ok{background:#3ca540}
    .badge-warn{background:#e38a19}
    .gauge{width:100%;height:10px;background:#ddd;border-radius:5px;margin:.4rem 0}
    .gauge-fill{height:10px;border-radius:5px;background:#3ca540;width:0%}
  </style>
</head>
<body>
  <div class="container">

    <!-- Entertainment disclaimer -->
    <div class="disclaimer-entertainment">
      <strong>For entertainment only:</strong> this tool is not a medical device.
    </div>

    <h1>{{ .Title }}</h1>

    <!-- SEO Intro -->
    <h2>Why Check Your Poo Colour?</h2>
    <p>Your stool colour can hint at hydration, diet, and gut health.
       Our <strong>Poo Colour Decoder</strong> runs entirely in your browser‚Äîno uploads, 100% private‚Äîand instantly classifies your stool shade.</p>

    <p><strong>100% private:</strong> nothing leaves your device.</p>

    <!-- Ad slot top -->
    <div id="ad-top" class="ad-slot"></div>

    <!-- Decoder UI -->
    <div class="decoder">
      <input type="file" id="file" accept="image/*">
      <canvas id="can" style="display:none;"></canvas>
    </div>
    <div id="result" class="result"><p class="placeholder">Upload a photo to decode its colour‚Ä¶</p></div>

    <!-- Ad slot bottom -->
    <div id="ad-bottom" class="ad-slot"></div>

    <hr>
    <h2>Frequently Asked Questions</h2>
    <dl class="faq">
      <dt>Is this medical advice?</dt>
      <dd>No‚Äîthis tool is for entertainment and educational use only. Consult a healthcare professional for any medical concerns.</dd>
      <dt>Is my data private?</dt>
      <dd>Yes‚Äîeverything runs locally in your browser; we do not collect or store your images or any personal data.</dd>
    </dl>

    <hr>
    <h2>Daily Poo Facts</h2>
    <p><a href="/posts/">Browse the archive ‚Üí</a></p>

    <!-- Medical disclaimer -->
    <div class="disclaimer-medical">
      <p><em>Not medical advice. If you have health concerns, please consult a qualified professional.</em></p>
    </div>
  </div>

<!-- -------------- Enhanced Decoder Script -------------- -->
<script>
console.log("‚ñ∂ Decoder script v2 loaded");

const fileInput=document.getElementById('file'),
      canvas   =document.getElementById('can'),
      ctx      =canvas.getContext('2d'),
      resultDiv=document.getElementById('result');

const idealBrown={h:30,s:0.6,l:0.35};
const range={hMin:15,hMax:45,sMin:0.30,sMax:0.60,lMin:0.20,lMax:0.50};
const weirdLines=[
  "Hmm‚Ä¶ that hue looks suspiciously non-poop! üòÖ",
  "Either your diet is cosmic, or that‚Äôs not stool at all!",
  "Purple poo? Picasso would approve üé®"
];

function rgbToHex(r,g,b){return"#"+[r,g,b].map(x=>x.toString(16).padStart(2,'0')).join('');}
function rgb2hsl(r,g,b){
  r/=255;g/=255;b/=255;
  const max=Math.max(r,g,b), min=Math.min(r,g,b), d=max-min;
  let h=0,s=0,l=(max+min)/2;
  if(d){
    s=l>0.5?d/(2-max-min):d/(max+min);
    switch(max){
      case r:h=(g-b)/d+(g<b?6:0);break;
      case g:h=(b-r)/d+2;break;
      case b:h=(r-g)/d+4;break;
    }
    h*=60;
  }
  return[h,s,l];
}
function classify(h){
  if(h<20||h>340) return{key:'red', title:'Red / Maroon'};
  if(h<40)        return{key:'brown',title:'Normal Brown'};
  if(h<75)        return{key:'yellow',title:'Yellow'};
  if(h<150)       return{key:'green', title:'Green'};
  if(h<260)       return{key:'black', title:'Black'};
  return{key:'pale', title:'Pale / Clay'};
}
function inNormal(h,s,l){
  return h>=range.hMin&&h<=range.hMax&&
         s>=range.sMin&&s<=range.sMax&&
         l>=range.lMin&&l<=range.lMax;
}

fileInput.addEventListener('change',e=>{
  const file=e.target.files[0];
  if(!file) return;
  resultDiv.innerHTML='';
  const img=new Image();
  img.onload=()=>{
    canvas.width=img.naturalWidth; canvas.height=img.naturalHeight;
    ctx.drawImage(img,0,0);
    const [r,g,b]=ctx.getImageData(canvas.width/2,canvas.height/2,1,1).data,
          hex=rgbToHex(r,g,b),
          [h,s,l]=rgb2hsl(r,g,b),
          cls=classify(h);
    const dh=(h-idealBrown.h)/360, ds=s-idealBrown.s, dl=l-idealBrown.l,
          closeness=Math.max(0,(1-Math.sqrt(dh*dh+ds*ds+dl*dl)/0.5)*100).toFixed(2),
          gaugeWidth=Math.max(0,Math.min(100,closeness)),
          badge=inNormal(h,s,l)
                ?'<span class="badge badge-ok">‚úÖ NORMAL</span>'
                :'<span class="badge badge-warn">‚ö†Ô∏è UNUSUAL</span>';
    let fun='';
    if(!['red','brown','yellow','green','black','pale'].includes(cls.key)){
      fun=weirdLines[Math.floor(Math.random()*weirdLines.length)];
    }
    fetch('/blurbs.json').then(r=>r.json()).then(blurbs=>{
      const blurb=blurbs[cls.key]||'';
      resultDiv.innerHTML=`
        <div class="swatch" style="background:${hex}"></div>
        <h3>${cls.title} ${badge}</h3>
        <div class="metric"><span>Brown Closeness:</span>${closeness}%</div>
        <div class="gauge"><div class="gauge-fill" style="width:${gaugeWidth}%"></div></div>
        <div class="metric"><span>Hue:</span>${Math.round(h)}¬∞</div>
        <div class="metric"><span>Saturation:</span>${Math.round(s*100)}%</div>
        <div class="metric"><span>Lightness:</span>${Math.round(l*100)}%</div>
        <p>${blurb}</p>
        ${fun?`<p><strong>${fun}</strong></p>`:''}
        <p class="normal-range"><strong>Typical Brown Corridor:</strong> Hue 15‚Äì45¬∞, Sat 30‚Äì60 %, Light 20‚Äì50 %</p>
      `;
    });
  };
  img.src=URL.createObjectURL(file);
});
</script>
</body>
</html>